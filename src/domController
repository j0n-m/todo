import pubSub from "./pubSub";

const domController = (() => {
  let allProjects = [];
  // DOM selectors
  const contentContainer = document.querySelector('.content');
  const projectList = document.querySelector('.project-list');
  const projectAddForm = document.querySelector('#project-add-form')
  const newProjectBtn = document.querySelector('.new-project-btn');
  const formContainer = document.querySelector('.form-field');
  const formCancelBtn = document.querySelector('#project-cancel-btn');
  const formTextbox = document.querySelector('#project-title-textbox');
  const errorMsg = document.querySelector('.error-msg');

  // Event Handlers
  projectAddForm.addEventListener('submit', projectAdd);
  newProjectBtn.addEventListener('click', displayForm);
  formCancelBtn.addEventListener('click', displayForm);

  //Pubsub
  pubSub.subscribe('updateProjectList', addToProjectList);
  pubSub.subscribe('error-duplicate', displayError)
  pubSub.subscribe('newTask', updateProjectList);

  // Event Functions
  function render() {
    let categoryBtns = document.querySelectorAll('.category-btn');
    console.log('called render')
    categoryBtns.forEach(categoryBtn => {
      categoryBtn.addEventListener('click', changeMainContent);
    });
  }
  function projectAdd(e) {
    e.preventDefault();
    pubSub.publish('addNewProject', { title: formTextbox.value });
    displayForm();
  }
  function displayForm() {
    formTextbox.value = '';
    formContainer.classList.toggle('hide');
  }
  function updateProjectList(obj) {
    console.log('updateProjectList:', obj);
    allProjects = obj;
  }
  function addToProjectList(projObj) {
    const projectTitle = projObj.title;
    const projectBtn = document.createElement('div');
    projectBtn.classList.add('btn');
    projectBtn.classList.add('category-btn');
    projectBtn.textContent = projectTitle;
    console.log('added to projectList:, ', projObj.title);

    projectList.appendChild(projectBtn);
    allProjects.push(projObj);
    render();
  }
  function displayError(msg) {
    errorMsg.textContent = msg;

    setTimeout(function () {
      errorMsg.textContent = '';
    }, 4000)
  }
  function changeMainContent(e) {
    console.log('DOM projects', allProjects);
    let projectTitle = e.target.textContent;
    allProjects.find(project => {
      if (project.getTitle() == projectTitle) {
        console.log(project.tasks);
      }
    })
  }
})();

export default domController;